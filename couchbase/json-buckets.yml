type: json
data:
  url: /pools/default/buckets/
  server: ${COUCHBASE_HOSTPORT}
  basicHttpAuthUsername: ${COUCHBASE_BASICAUTH_USERNAME}
  basicHttpAuthPassword: ${COUCHBASE_BASICAUTH_PASSWORD}

observation:
  - name: nodes
    metricNamespace: couchbase
    path: $.[?(@.name=${bucketName})]

    metric:
      - name: bg.wait.time.avg
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.avg_bg_wait_time[0]
        type: long_gauge
        label: backround wait time
        unit: seconds
        description: Average background wait time

      - name: disk.commit.time.avg
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.avg_disk_commit_time[0]
        type: long_gauge
        label: disk commit time
        unit: seconds
        description: Average disk commit time

      - name: disk.update.time.avg
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.avg_disk_update_time[0]
        type: long_gauge
        label: disk update time
        unit: microseconds
        description: Average disk update time

      - name: bg.wait.total
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.bg_wait_total[0]
        type: long_gauge
        label: bytes read
        unit: bytes
        description: Bytes read

      - name: bytes.read
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.bytes_read[0]
        type: long_gauge
        label: bytes read
        unit: bytes
        description: Bytes read

      - name: bytes.written
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.bytes_written[0]
        type: long_gauge
        label: bytes written
        unit: bytes
        description: Bytes written

      - name: cas.badval
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cas_badval[0]
        type: long_gauge
        label:
        description: Compare and Swap bad values

      - name: cas.hits
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cas_hits[0]
        type: long_gauge
        label:
        description: Compare and Swap hits

      - name: cas.misses
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cas_misses[0]
        type: long_gauge
        label:
        description: Compare and Swap misses

      - name: cmd.get
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cmd_get[0]
        type: long_gauge
        label:
        description: Compare and Swap gets

      - name: cmd.set
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cmd_set[0]
        type: long_gauge
        label:
        description: Compare and Swap sets

      - name: couch_docs_actual_disk_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_docs_actual_disk_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Couch docs total size on disk in bytes

      - name: couch_docs_data_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_docs_data_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Couch docs data size in bytes

      - name: couch_docs_disk_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_docs_disk_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Couch docs total size in bytes

      - name: couch_docs_fragmentation
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_docs_fragmentation[0]
        type: long_gauge
        label:
        unit: %
        description: Couch docs fragmentation

      - name: couch_spatial_data_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_spatial_data_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Size of object data for spatial views

      - name: couch_spatial_disk_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_spatial_disk_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Amount of disk space occupied by spatial views

      - name: couch_spatial_ops
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_spatial_ops[0]
        type: long_gauge
        label:
        description: Spatial operations

      - name: couch_total_disk_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_total_disk_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Couch total disk size

      - name: couch_views_data_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_views_data_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Size of object data for views

      - name: couch_views_disk_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_views_disk_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Amount of disk space occupied by views

      - name: couch_views_fragmentation
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.couch_views_fragmentation[0]
        type: long_gauge
        label:
        unit: %
        description: View fragmentation

      - name: cpu_idle_ms
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cpu_idle_ms[0]
        type: long_gauge
        label:
        unit: milliseconds
        description: CPU idle milliseconds

      - name: cpu_utilization_rate
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.cpu_utilization_rate[0]
        type: long_gauge
        label:
        unit: %
        description: CPU utilization percentage

      - name: curr_connections
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.curr_connections[0]
        type: long_gauge
        label:
        description: Current bucket connections

      - name: curr_items_tot
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.curr_items_tot[0]
        type: long_gauge
        label:
        description: Total number of items

      - name: curr_items
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.curr_items[0]
        type: long_gauge
        label:
        description: Number of active items in memory

      - name: decr_hits
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.decr_hits[0]
        type: long_gauge
        label:
        description: Decrement hits

      - name: decr_misses
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.decr_misses[0]
        type: long_gauge
        label:
        description: Decrement misses

      - name: delete_hits
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.delete_hits[0]
        type: long_gauge
        label:
        description: Delete hits

      - name: delete_misses
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.delete_misses[0]
        type: long_gauge
        label:
        description: Delete misses

      - name: disk_commit_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.disk_commit_count[0]
        type: long_gauge
        label:
        description: Disk commits

      - name: disk_update_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.disk_update_count[0]
        type: long_gauge
        label:
        description: Disk updates

      - name: disk_write_queue
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.disk_write_queue[0]
        type: long_gauge
        label:
        description: Disk write queue depth

      - name: ep_bg_fetched
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_bg_fetched[0]
        type: long_gauge
        label:
        description: Disk reads per second

      - name: ep_cache_miss_rate
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_cache_miss_rate[0]
        type: long_gauge
        label:
        description: Cache miss rate

      - name: ep_cache_miss_ratio
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_cache_miss_ratio[0]
        type: long_gauge
        label:
        unit: %
        description: Cache miss ratio

      - name: ep_dcp_fts_backoff
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_fts_backoff[0]
        type: long_gauge
        label:
        description: Number of backoffs for fts DCP connections

      - name: ep_dcp_fts_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_fts_count[0]
        type: long_gauge
        label:
        description: Number of fts DCP connections

      - name: ep_dcp_fts_items_remaining
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_fts_items_remaining[0]
        type: long_gauge
        label:
        description: Number of fts items remaining to be sent

      - name: ep_dcp_fts_items_sent
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_fts_items_sent[0]
        type: long_gauge
        label:
        description: Number of fts items sent

      - name: ep_dcp_fts_producer_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_fts_producer_count[0]
        type: long_gauge
        label:
        description: Number of fts producers

      - name: ep_dcp_2i_total_bytes
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_2i_total_bytes[0]
        type: long_gauge
        label:
        unit: bytes/second
        description: Number bytes per second being sent for indexes DCP connections

      - name: ep_dcp_other_backoff
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_other_backoff[0]
        type: long_gauge
        label:
        description: Number of backoffs for other DCP connections

      - name: ep_dcp_other_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_other_count[0]
        type: long_gauge
        label:
        description: Number of other DCP connections

      - name: ep_dcp_other_items_remaining
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_other_items_remaining[0]
        type: long_gauge
        label:
        description: Number of other items remaining to be sent

      - name: ep_dcp_other_items_sent
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_other_items_sent[0]
        type: long_gauge
        label:
        description: Number of other items sent

      - name: ep_dcp_other_producer_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_other_producer_count[0]
        type: long_gauge
        label:
        description: Number of other producers

      - name: ep_dcp_other_total_bytes
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_other_total_bytes[0]
        type: long_gauge
        label:
        unit: bytes/second
        description: Number bytes per second being sent for other DCP connections

      - name: ep_dcp_xdcr_backoff
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_xdcr_backoff[0]
        type: long_gauge
        label:
        description: Number of backoffs for xdcr DCP connections

      - name: ep_dcp_xdcr_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_xdcr_count[0]
        type: long_gauge
        label:
        description: Number of xdcr DCP connections

      - name: ep_dcp_xdcr_items_remaining
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_xdcr_items_remaining[0]
        type: long_gauge
        label:
        description: Number of xdcr items remaining to be sent

      - name: ep_dcp_xdcr_items_sent
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_xdcr_items_sent[0]
        type: long_gauge
        label:
        description: Number of xdcr items sent

      - name: ep_dcp_xdcr_producer_count
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_xdcr_producer_count[0]
        type: long_gauge
        label:
        description: Number of xdcr producers

      - name: ep_dcp_xdcr_total_bytes
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_dcp_xdcr_total_bytes[0]
        type: long_gauge
        label:
        unit: bytes/second
        description: Number bytes per second being sent for xdcr DCP connections

      - name: ep_diskqueue_drain
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_diskqueue_drain[0]
        type: long_gauge
        label:
        description: Total Drained items on disk queue

      - name: ep_diskqueue_fill
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_diskqueue_fill[0]
        type: long_gauge
        label:
        description: Total enqueued items on disk queue

      - name: ep_diskqueue_items
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_diskqueue_items[0]
        type: long_gauge
        label:
        description: Total number of items waiting to be written to disk

      - name: ep_flusher_todo
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_flusher_todo[0]
        type: long_gauge
        label:
        description: Number of items currently being written

      - name: ep_item_commit_failed
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_item_commit_failed[0]
        type: long_gauge
        label:
        description: Number of times a transaction failed to commit due to storage errors

      - name: ep_kv_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_kv_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: Total amount of user data cached in RAM in this bucket

      - name: ep_max_size
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_max_size[0]
        type: long_gauge
        label:
        unit: bytes
        description: The maximum amount of memory this bucket can use

      - name: ep_mem_high_wat
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_mem_high_wat[0]
        type: long_gauge
        label:
        unit: bytes
        description: Mem usage high water mark for auto-evictions

      - name: ep_mem_low_wat
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_mem_low_wat[0]
        type: long_gauge
        label:
        unit: bytes
        description: Mem usage low water mark for auto-evictions

      - name: ep_meta_data_memory
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_meta_data_memory[0]
        type: long_gauge
        label:
        unit: bytes
        description: Total amount of item metadata consuming RAM in this bucket

      - name: ep_num_non_resident
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_non_resident[0]
        type: long_gauge
        label:
        description: Number of non-resident items

      - name: ep_num_ops_del_meta
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_ops_del_meta[0]
        type: long_gauge
        label:
        description: Number of delete operations per second for this bucket as the target for XDCR

      - name: ep_num_ops_del_ret_meta
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_ops_del_ret_meta[0]
        type: long_gauge
        label:
        description: Number of delRetMeta operations per second for this bucket as the target for XDCR

      - name: ep_num_ops_get_meta
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_ops_get_meta[0]
        type: long_gauge
        label:
        description: Number of read operations per second for this bucket as the target for XDCR

      - name: ep_num_ops_set_meta
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_ops_set_meta[0]
        type: long_gauge
        label:
        description: Number of set operations per second for this bucket as the target for XDCR

      - name: ep_num_ops_del_meta
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_ops_del_meta[0]
        type: long_gauge
        label:
        description: Number of delete operations per second for this bucket as the target for XDCR

      - name: ep_num_ops_set_ret_meta
        source: json:/pools/default/buckets/${bucketName}/stats $.op.samples.ep_num_ops_set_ret_meta[0]
        type: long_gauge
        label:
        description: Number of setRetMeta operations per second for this bucket as the target for XDCR

    tag:
      - name: bucket.name
        value: ${bucketName}

