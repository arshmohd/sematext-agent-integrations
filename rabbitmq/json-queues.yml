type: json
data:
  url: /api/queues
  server: ${SPM_MONITOR_RABBITMQ_API_URL}
  basicHttpAuthUsername: ${SPM_MONITOR_RABBITMQ_BASICAUTH_USERNAME}
  basicHttpAuthPassword: ${SPM_MONITOR_RABBITMQ_BASICAUTH_PASSWORD}

observation:
  - name: queues
    metricNamespace: rabbitmq
    path: $.[?(@.name=${name} && @.vhost=${vhost})]

    metric:
      - name: queues.consumers.active
        source: active_consumers
        type: long_gauge
        label: active consumers
        description: Number of active consumers, consumers that can immediately receive any messages sent to the queue

      - name: queues.consumers
        source: consumers
        type: long_gauge
        label: consumers
        description: Number of consumers

      - name: queues.consumer.utilisation
        source: consumer_utilisation
        type: long_gauge
        label: consumer utilisation
        description: The ratio of time that a queue's consumers can take new messages

      - name: queues.memory
        source: memory
        type: long_gauge
        label: memory
        description: Bytes of memory consumed by the Erlang process associated with the queue, including stack, heap and internal structures

      - name: queues.messages
        source: messages
        type: long_gauge
        label: messages
        description: Count of the total messages in the queue

      - name: queues.messages.rate
        source: messages_details/rate
        type: long_gauge
        label: messages rate
        unit: message/second
        description: Count per second of the total messages in the queue

      - name: queues.messages.ready
        source: messages_ready
        type: long_gauge
        label: ready messages
        description: Number of messages ready to be delivered to clients

      - name: queues.messages.ready.rate
        source: messages_ready_details/rate
        type: double_gauge
        label: ready messages rate
        unit: message/second
        description: Number per second of messages ready to be delivered to clients

      - name: queues.messages.unacknowledged
        source: messages_unacknowledged
        type: long_gauge
        label: unacknowledged messages
        description: Number of messages delivered to clients but not yet acknowledged

      - name: queues.messages.unacknowledged.rate
        source: messages_unacknowledged_details/rate
        type: double_gauge
        label: unacknowledged messages rate
        unit: message/second
        description: Number per second of messages delivered to clients but not yet acknowledged

      - name: queues.message_stats.ack
        source: message_stats/ack
        type: long_gauge
        label: ack messages
        description: Number of messages delivered to clients and acknowledged

      - name: queues.message_stats.ack.rate
        source: message_stats/ack_details/rate
        type: double_gauge
        label: ack messages rate
        unit: message/second
        description: Number per second of messages delivered to clients and acknowledged

      - name: queues.message_stats.deliver
        source: message_stats/deliver
        type: long_gauge
        label: delivered messages
        description: Count of messages delivered in acknowledgement mode to consumers

      - name: queues.message_stats.deliver.rate
        source: message_stats/deliver_details/rate
        type: double_gauge
        label: delivered messages rate
        unit: message/second
        description: Number per second of messages delivered in acknowledgement mode to consumers

      - name: queues.message_stats.deliver.get
        source: message_stats/deliver_get
        type: long_gauge
        label: delivered get messages
        description: Sum of messages delivered in acknowledgement mode to consumers, in no-acknowledgement mode to consumers, in acknowledgement mode in response to basic.get, and in no-acknowledgement mode in response to basic.get.

      - name: queues.message_stats.deliver.get.rate
        source: message_stats/deliver_get_details/rate
        type: double_gauge
        label: delivered get messages rate
        unit: message/second
        description: Rate per second of the sum of messages delivered in acknowledgement mode to consumers, in no-acknowledgement mode to consumers, in acknowledgement mode in response to basic.get, and in no-acknowledgement mode in response to basic.get.

      - name: queues.message_stats.publish
        source: message_stats/publish
        type: long_gauge
        label: published messages
        description: Count of messages published

      - name: queues.message_stats.publish.rate
        source: message_stats/publish_details/rate
        type: double_gauge
        label: published messages rate
        unit: message/second
        description: Rate per second of messages published

      - name: queues.message_stats.redeliver
        source: message_stats/redeliver
        type: long_gauge
        label: redelivered messages
        description: Count of subset of messages in deliver_get which had the redelivered flag set

      - name: queues.message_stats.redeliver.rate
        source: message_stats/redeliver_details/rate
        type: double_gauge
        label: redelivered messages rate
        unit: message/second
        description: Rate per second of subset of messages in deliver_get which had the redelivered flag set

    tag:
      - name: queues.vhost
        value: ${vhost}

      - name: queues.name
        value: ${name}