type: json
data:
  url: /api/nodes
  server: ${SPM_MONITOR_RABBITMQ_API_URL}
  basicHttpAuthUsername: ${SPM_MONITOR_RABBITMQ_BASICAUTH_USERNAME}
  basicHttpAuthPassword: ${SPM_MONITOR_RABBITMQ_BASICAUTH_PASSWORD}
  smileFormat: true

observation:
  - name: nodes
    metricNamespace: rabbitmq
    path: $.[?(@.name=${name})]

    metric:
      - name: file.used
        source: fd_used
        type: long_gauge
        label: used file
        description: Used file descriptors

      - name: disk.free
        source: disk_free
        type: long_gauge
        label: free space
        unit: byte
        description: Current free disk space

      - name: mem.used
        source: mem_used
        type: long_gauge
        label: used memory
        description: Memory used in bytes

      - name: process.wait
        source: run_queue
        type: long_gauge
        label: warting process
        description: Average number of Erlang processes waiting to run

      - name: file.sockets
        source: sockets_used
        type: long_gauge
        label: socket file
        description: Number of file descriptors used as sockets

      - name: partitions
        source: partitions
        type: long_gauge
        label: partitions
        description: Number of network partitions this node is seeing

      - name: node.running
        source: running
        type: long_gauge
        label: running
        description: Is the node running or not

      - name: mem.alarm
        source: mem_alarm
        type: long_gauge
        label: memory alarm
        description: Does the host has memory alarm

      - name: disk.alarm
        source: disk_free_alarm
        type: long_gauge
        label: disk alarm
        description: Does the node have disk alarm

    tag:
      - name: node.name
        value: name