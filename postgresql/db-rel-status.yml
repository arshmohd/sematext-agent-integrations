type: db
data:
  query: SELECT * FROM pg_stat_user_tables;
  dbUrl: jdbc:postgresql://${POSTGRESQL_DB_HOST_PORT}
  dbDriverClass: org.postgresql.Driver
  dbUser: ${POSTGRESQL_DB_USER}
  dbPassword: ${POSTGRESQL_DB_PASSWORD}
  dbAdditionalConnectionParams: ${POSTGRESQL_DB_ADDITIONAL_PARAMS}

observation:
  - name: usertables
    metricNamespace: postgresql

    metric:
      - name: tables.table
        source: relname
        type: text
        send: false
        label: Table name

      - name: tables.schema
        source: schemaname
        type: text
        send: false
        label: Schema name

      - name: tables.sequential.scan
        source: seq_scan
        type: long_counter
        label: Sequential scans
        description: Number of sequential scans initiated on this table

      - name: tables.sequential.rows.fetched
        source: seq_tup_read
        type: long_counter
        label: Sequential rows fetched
        description: Number of live rows fetched by sequential scans

      - name: tables.index.rows.fetched
        source: idx_tup_fetch
        type: long_counter
        label: Index rows fetched
        description: Number of live rows fetched by index scans

      - name: tables.rows.inserted
        source: n_tup_ins
        type: long_counter
        label: Inserted rows
        description: Number of rows inserted

      - name: tables.rows.updated
        source: n_tup_upd
        type: long_counter
        label: Updated rows
        description: Number of rows updated

      - name: tables.user.rows.deleted
        source: n_tup_del
        type: long_counter
        label: Deleted rows
        description: Number of rows deleted

      - name: tables.rows.hot.updated
        source: n_tup_hot_upd
        type: long_counter
        label: Hot updated rows
        description: Number of rows hot updated (i.e., with no separate index update required)

      - name: tables.rows.live
        source: n_live_tup
        type: gauge
        label: Live rows
        description: Estimated number of live rows

      - name: tables.rows.dead
        source: n_dead_tup
        type: gauge
        label: Dead rows
        description: Estimated number of dead rows

    tag:
      - name: posgresql.table
        value: eval:${table}
      - name: posgresql.schema
        value: eval:${schema}
