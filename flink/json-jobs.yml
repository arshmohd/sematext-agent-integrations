type: json
data:
  url: /v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration
  server: ${FLINK_HOSTPORT}

observation:
  - name: jobs
    metricNamespace: flink
    path: $

    metric:
      - name: jobs.uptime
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=uptime)].sum
        type: long_gauge
        label: uptime
        description: The time that the job has been running without interruption

      - name: jobs.downtime
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=downtime)].sum
        type: long_gauge
        label: downtime
        description: For jobs currently in a failing/recovering situation, the time elapsed during this outage. 0 for running jobs and -1 for completed jobs

      - name: jobs.restartingTime
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=restartingTime)].sum
        type: long_gauge
        unit: ms
        label: restarting time
        description: The time it took to restart the job, or how long the current restart has been in progress

      - name: jobs.full.restarts
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=fullRestarts)].sum
        type: long_gauge
        label: full restarts
        description: The total number of full restarts since this job was submitted

      - name: jobs.checkpoints.total
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=totalNumberOfCheckpoints)].sum
        type: long_gauge
        label: checkpoints
        description: The number of total checkpoints (in progress, completed, failed)

      - name: jobs.checkpoints.failed
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=numberOfFailedCheckpoints)].sum
        type: long_gauge
        label: failed checkpoints
        description: The number of failed checkpoints

      - name: jobs.checkpoints.inprogress
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=numberOfInProgressCheckpoints)].sum
        type: long_gauge
        label: in progress checkpoints
        description: The number of in progress checkpoints

      - name: jobs.checkpoints.completed
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=numberOfCompletedCheckpoints)].sum
        type: long_gauge
        label: completed checkpoint
        description: The number of successfully completed checkpoints

      - name: jobs.checkpoints.last.size
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=lastCheckpointSize)].sum
        type: long_gauge
        unit: bytes
        label: last checkpoint size
        description: The total size of the last checkpoint

      - name: jobs.checkpoints.last.buffered
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=lastCheckpointAlignmentBuffered)].sum
        type: long_gauge
        unit: bytes
        label: buffered
        description: The number of buffered bytes during alignment over all subtasks for the last checkpoint

      - name: jobs.checkpoints.last.duration
        source: json:/v1/jobs/metrics?get=numberOfFailedCheckpoints,lastCheckpointSize,lastCheckpointExternalPath,totalNumberOfCheckpoints,lastCheckpointRestoreTimestamp,lastCheckpointAlignmentBuffered,restartingTime,uptime,numberOfInProgressCheckpoints,downtime,numberOfCompletedCheckpoints,fullRestarts,lastCheckpointDuration $.[?(@.id=lastCheckpointDuration)].sum
        type: long_gauge
        unit: ms
        label: duration
        description: The time it took to complete the last checkpoint
