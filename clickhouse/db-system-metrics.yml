type: db
data:
  query: SELECT * FROM metrics;
  dbUrl: jdbc:clickhouse://${SPM_MONITOR_CLICKHOUSE_DB_HOST_PORT}/system
  dbDriverClass: ru.yandex.clickhouse.ClickHouseDriver
  dbUser: ${SPM_MONITOR_CLICKHOUSE_DB_USER}
  dbPassword: ${SPM_MONITOR_CLICKHOUSE_DB_PASSWORD}
  dbAdditionalConnectionParams: ${SPM_MONITOR_CLICKHOUSE_DB_ADDITIONAL_PARAMS}
  #  dbVerticalModel="true" - because output of `SELECT * FROM metrics;` query gives each attribute in its own row
  # (1st column being attribute name, 2nd column being attribute value)
  dbVerticalModel: true

observation:
  - name: metrics
    metricNamespace: clickhouse

    metric:
      - name: tcp.connection.count
        source: TCPConnection
        type: long_gauge
        label: TCP Connections
      - name: http.connection.count
        source: HTTPConnection
        type: long_gauge
        label: HTTP Connections
      - name: interserver.connection.count
        source: InterserverConnection
        type: long_gauge
        label: Interserver Connections
      - name: query.thread.count
        source: QueryThread
        type: long_gauge
        label: Query Threads
        description: Current running query threads
      - name: preempted.query.count
        source: QueryPreempted
        type: long_gauge
        label: Preempted Queries
        description: Current number of query executions preempted due to high priority queries
      - name: backgroundpool.tasks
        source: BackgroundPoolTask
        type: long_gauge
        label: BackgroundPool Tasks
      - name: read.count
        source: Read
        type: long_gauge
        label: Reads
        description: Current running reads
      - name: write.count
        source: Write
        type: long_gauge
        label: Writes
        description: Current running writes
      - name: memory.tracking
        source: MemoryTracking
        type: long_gauge
        label: Memory
        description: Number of bytes allocated for query processing
        unit: bytes
      - name: merge.count
        source: Merge
        type: long_gauge
        label: Merge
        description: Current running merges
      - name: open.files.read
        source: OpenFileForRead
        type: long_gauge
        label: Open Files (Read)
      - name: open.files.write
        source: OpenFileForWrite
        type: long_gauge
        label: Open Files (Write)
      - name: distributed.send
        source: DistributedSend
        type: long_gauge
        label: Distributed Sends
        description: Currently running writes to remote servers in distributed storage engine
      - name: zk.leader.election
        source: LeaderElection
        type: long_gauge
        label: Current Leader elections
      - name: zk.ephemeral.nodes
        source: EphemeralNode
        type: long_gauge
        label: Ephemeral nodes
      - name: zk.sessions
        source: ZooKeeperSession
        type: long_gauge
        label: Zookeeper sessions
        description: Current Zookeeper sessions
      - name: zk.watches
        source: ZooKeeperWatch
        type: long_gauge
        label: Zookeeper watches
        description: Current active Zookeeper watches
      - name: zk.requests
        source: ZooKeeperRequest
        type: long_gauge
        label: Zookeeper requests
        description: Current zookeeper requests in progress
