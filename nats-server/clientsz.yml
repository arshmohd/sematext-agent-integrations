type: json
data:
  url: /streaming/clientsz
  server: ${NATS_SERVER_HOSTPORT}

observation:
  - name: clientsz
    metricNamespace: nats
    path: $.

    metric:
      - name: streaming.clients.total
        source: total
        type: long_gauge
        label: total channels

      - name: streaming.clients.limit
        source: limit
        type: long_gauge
        label: max channels

  - name: clientsz_client_subscription
    metricNamespace: nats
    path: $.clients[?(@.id=${clientName}})].subscriptions.${subscriptionName}

    metric:
      - name: streaming.clients.subscriptions.pending.count
        source: counter
        type: long_gauge
        label: pending count

      - name: streaming.clients.subscriptions.sent
        source: counter
        type: long_gauge
        label: pending count

    tag:
      - name: nats.streaming.clients.ids
        value: ${clientName}
      - name: nats.streaming.clients.subscriptions.name
        value: ${subscriptionName}
