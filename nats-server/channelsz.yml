type: json
data:
  url: /streaming/channelsz
  server: ${NATS_SERVER_HOSTPORT}

observation:
  - name: channelsz
    metricNamespace: nats
    path: $.

    metric:
      - name: streaming.channels.total
        source: total
        type: long_gauge
        label: total channels

      - name: streaming.channels.limit
        source: limit
        type: long_gauge
        label: max channels

  - name: channelsz_channel
    metricNamespace: nats
    path: $.channels[?(@.name=${channelName}})]

    metric:
      - name: streaming.channels.messages
        source: msgs
        type: counter
        label: The total of messages

      - name: streaming.channels.bytes
        source: bytes
        type: counter
        unit: bytes
        label: The total of bytes

    tag:
      - name: nats.streaming.channels.name
        value: ${channelName}


  - name: channelsz_channel_subscription
    metricNamespace: nats
    path: $.channels[?(@.name=${channelName}})].subscriptions.${subscriptionName}

    metric:
      - name: streaming.channels.subscriptions.pending.count
        source: counter
        type: long_gauge
        label: pending count

      - name: streaming.channels.subscriptions.sent
        source: counter
        type: long_gauge
        label: pending count

    tag:
      - name: nats.streaming.channels.name
        value: ${channelName}
      - name: nats.streaming.channels.subscriptions.name
        value: ${subscriptionName}